{
    "title": "RecipeEmbeddings",
    "description": "Search recipes using embeddings.",
    "databases": {
      "5krecipes": {
        "tables" : {
            "recipes_fts" : {
                "hidden": false
            },
            "recipes" : {
                "label_column": "id"
            }
        },
        "queries": {
          "sample": {
            "hide_sql": true,
            "sql": "SELECT * FROM recipes ORDER BY RANDOM() LIMIT 10;"
          },
          "vibesearch": {
            "hide_sql": false,
            "sql": "SELECT r.id, r.Title, ROUND(CAST(json_extract(value, '$[1]') AS REAL), 3) AS score FROM json_each(faiss_search_with_scores('5krecipes', 'embeddings', (SELECT openai_embedding(:query, :openai_api_key)), 10)) AS json_data JOIN recipes AS r ON r.id = CAST(json_extract(json_data.value, '$[0]') AS INTEGER) WHERE length(coalesce(:query, ''))>0;"
          },
          "similar": {
            "hide_sql": true,
            "sql": "SELECT * FROM (SELECT *, ROW_NUMBER() OVER (PARTITION by brand ORDER BY title) AS rn FROM (WITH related AS (SELECT value FROM json_each(faiss_search('faucets', 'embeddings', (SELECT embedding FROM embeddings WHERE id = :input_faucet), 200))) SELECT * FROM related, faucets WHERE related.value = faucets.embedding_id) as similar) WHERE rn = 1"
          }
        }
      }
    },
    "plugins": {
      "datasette-scale-to-zero": {
        "duration": "10m"
      },
      "datasette-faiss": {
        "tables": [
            ["5krecipes", "embeddings"]
        ]
      }
    }
  }


